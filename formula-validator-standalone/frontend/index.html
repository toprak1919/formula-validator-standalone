<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Formula Editor with Backend Validation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script type="module" src="config.js"></script>
    <link rel="stylesheet" href="css/styles.css">

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Advanced Formula Editor with Backend Validation (mXparser)</h1>
            <p>Professional formula validation and evaluation with advanced features</p>
        </div>

        <div class="toolbar">
            <button class="btn" id="validateBtn">
                <span class="icon icon-check" aria-hidden="true"></span>
                Validate
            </button>
            <button class="btn btn-secondary" id="clearBtn">
                <span class="icon icon-trash" aria-hidden="true"></span>
                Clear
            </button>
            <button class="btn btn-secondary" id="samplesBtn">
                <span class="icon icon-doc" aria-hidden="true"></span>
                Samples
            </button>
            <button class="btn btn-secondary" id="testSuiteBtn">
                <span class="icon icon-list" aria-hidden="true"></span>
                Test Suite
            </button>
            <button class="btn btn-secondary" id="copyFormulaBtn">
                <span class="icon icon-copy" aria-hidden="true"></span>
                Copy Formula
            </button>
            <button class="btn btn-secondary" id="copyResultBtn">
                <span class="icon icon-copy" aria-hidden="true"></span>
                Copy Result
            </button>
            <button class="btn btn-secondary" id="themeToggleBtn">
                <span class="icon icon-moon" aria-hidden="true"></span>
                Theme
            </button>
            <div class="btn-group">
                <button class="btn btn-secondary" id="simulateChangeBtn">
                    <span class="icon icon-refresh" aria-hidden="true"></span>
                    Simulate Changes
                </button>
            </div>
        </div>

        <div class="main-content">
            <!-- Left Panel - Sources -->
            <div class="panel source-panel" id="sourcePanel">
                <div class="source-panel-header">
                    <div class="source-panel-title">Sources</div>
                    <button class="icon-btn collapse-btn" id="sourcePanelToggle" aria-expanded="true" aria-label="Collapse sources">
                        <span class="icon icon-chevron-up" aria-hidden="true"></span>
                    </button>
                </div>

                <div class="source-keyboard" id="sourceKeyboard"></div>

                <div class="source-panel-body" id="sourcePanelBody">
                    <div class="tabs">
                        <button class="tab active" data-tab="measured">Measured Values</button>
                        <button class="tab" data-tab="constants">Constants</button>
                    </div>

                    <div class="tab-content active" id="measuredTab">
                        <div class="panel-title">
                            <div class="panel-title-text">
                                Measured Values
                            </div>
                            <div class="panel-actions">
                                <button class="icon-btn" id="addMeasuredBtn" title="Add New">+</button>
                            </div>
                        </div>
                        <div class="search-box">
                            <input type="text" placeholder="Search measured values..." id="measuredSearch">
                        </div>
                        <div class="source-list" id="measuredValuesList"></div>
                    </div>

                    <div class="tab-content" id="constantsTab">
                        <div class="panel-title">
                            <div class="panel-title-text">
                                Constants
                            </div>
                            <div class="panel-actions">
                                <button class="icon-btn" id="addConstantBtn" title="Add New">+</button>
                            </div>
                        </div>
                        <div class="search-box">
                            <input type="text" placeholder="Search constants..." id="constantsSearch">
                        </div>
                        <div class="source-list" id="constantsList"></div>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Editor -->
            <div class="panel">
                <div class="panel-title formula-panel-header">
                    <div class="panel-title-text">Formula Editor</div>
                    <div class="panel-actions formula-actions">
                        <button class="icon-btn" id="editorCollapseToggle" aria-expanded="true" aria-label="Collapse editor">
                            <span class="icon icon-chevron-up" aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
                <div class="editor-container" id="editorContainer">
                    <div class="validation-status" id="validationStatus">
                        <span class="status-icon"></span>
                        <span>Ready</span>
                    </div>
                    <div id="editor"></div>
                </div>
                <div class="errors-container" id="errorsContainer">
                    <div id="errorsList"></div>
                </div>
                <div class="result-section">
                    <div class="result-label">Calculation Result</div>
                    <div class="result-value">
                        <span id="resultValue">Enter a formula...</span>
                        <button class="btn btn-secondary result-copy" id="resultCopyBtn">
                            <span class="icon icon-copy" aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
                <div class="formula-history">
                    <div class="history-title">Formula History</div>
                    <div class="history-list" id="historyList"></div>
                </div>
                    <div class="saved-formulas">
                        <div class="saved-header">
                            <div class="saved-title">Saved Formulas</div>
                            <div class="saved-actions">
                                <input type="text" id="saveFormulaName" class="saved-input" placeholder="Formula name">
                                <button class="btn btn-secondary" id="saveFormulaBtn">
                                    <span class="icon icon-save" aria-hidden="true"></span>
                                    Save Current
                                </button>
                            </div>
                        </div>
                        <div class="saved-list" id="savedFormulasList"></div>
                    </div>
                </div>

            <!-- Right Panel - Functions -->
            <div class="panel">
                    <div class="panel-title">
                        <div class="panel-title-text">Functions</div>
                    </div>
                <div class="tabs">
                    <button class="tab active" data-tab="basic-func">Basic</button>
                    <button class="tab" data-tab="trig-func">Trigonometric</button>
                    <button class="tab" data-tab="math-func">Mathematical</button>
                    <button class="tab" data-tab="stat-func">Statistical</button>
                </div>
                <div class="tab-content active" id="basic-funcTab">
                    <div class="functions-grid" id="basicFunctions"></div>
                </div>
                <div class="tab-content" id="trig-funcTab">
                    <div class="functions-grid" id="trigFunctions"></div>
                </div>
                <div class="tab-content" id="math-funcTab">
                    <div class="functions-grid" id="mathFunctions"></div>
                </div>
                <div class="tab-content" id="stat-funcTab">
                    <div class="functions-grid" id="statFunctions"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Backend Indicator -->
    <div class="backend-indicator" id="backendIndicator">
        <span>Backend: Ready</span>
        <span class="request-count" id="requestCount">0</span>
    </div>

    <!-- Test Suite Modal -->
    <div class="modal" id="testModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Formula Test Suite</h2>
                <button class="modal-close" id="closeTestModal" aria-label="Close"></button>
            </div>
            <div class="test-controls">
                <button class="btn" id="runTestsBtn">Run All Tests</button>
                <button class="btn btn-secondary" id="exportTestsBtn">Export Results</button>
                <div class="test-speed">
                    <label>Speed:</label>
                    <select id="testSpeed">
                        <option value="instant">Instant</option>
                        <option value="fast">Fast</option>
                        <option value="normal">Normal</option>
                    </select>
                </div>
            </div>
            <div class="test-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="testProgress" style="width: 0%"></div>
                </div>
                <div class="progress-stats">
                    <span id="testProgressText">0 / 0 tests</span>
                    <span id="testStats">Pass: 0 | Fail: 0</span>
                </div>
            </div>
            <div class="test-results" id="testResults"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- ACE Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ext-language_tools.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/theme-textmate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/theme-chrome.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/theme-twilight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/theme-tomorrow_night.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/mode-javascript.min.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
